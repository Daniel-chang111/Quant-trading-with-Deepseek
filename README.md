[README.md](https://github.com/user-attachments/files/25366435/README.md)
# 📈 코스피 퀀트 트레이딩 시스템 v2.0

> AI(인공지능)를 활용해 코스피 상위 500개 종목을 분석하고,  
> 다음달에 오를 가능성이 높은 종목 TOP 20을 자동으로 선정하는 시스템입니다.

---

## 🗂️ 목차
1. [이 프로그램이 하는 일](#-이-프로그램이-하는-일)
2. [전체 흐름도](#-전체-흐름도)
3. [사용한 기술](#-사용한-기술)
4. [실행 환경 준비](#-실행-환경-준비)
5. [실행 방법](#-실행-방법)
6. [결과 해석 방법](#-결과-해석-방법)
7. [주의사항](#️-주의사항)
8. [버전 히스토리](#-버전-히스토리)

---

## 🎯 이 프로그램이 하는 일

```
① 데이터 수집   →   ② AI 학습   →   ③ 종목 선정   →   ④ 성과 확인
 (2023~2025)        (패턴 학습)      (TOP 20 선정)      (2월 수익률)
```

쉽게 말하면, **과거 3년치 주식 데이터를 AI에게 가르쳐서**  
"이런 특징을 가진 종목이 다음달에 오르더라"는 패턴을 학습시키고,  
그 패턴을 바탕으로 **실제 투자할 종목을 추천**하는 시스템입니다.

---

## 🔄 전체 흐름도

```
[Step 1] 데이터 수집 (약 3~4시간 소요)
    └─ 2023년 1월 ~ 2025년 12월 (36개월)
    └─ 코스피 시가총액 상위 500개 종목
    └─ 종목당 12가지 특성값 수집

[Step 2] 학습 레이블 생성
    └─ 각 종목의 '다음달 수익률' 계산
    └─ 올랐으면 1, 내렸으면 0으로 표시

[Step 3] AI 모델 학습
    └─ 3개 모델 앙상블 (RF + GBM + LightGBM)
    └─ 시계열 교차검증으로 성능 평가

[Step 4] 2026년 1월 종목 선정
    └─ AI 점수 기준 상위 20개 종목 출력

[Step 5] 2026년 2월 성과 확인
    └─ 실제 수익률, 승률 계산

[Step 6] 결과 시각화
    └─ 4개 그래프로 결과 요약
```

---

## 🔧 사용한 기술

### AI 모델 (3개 앙상블)

| 모델 | 만든 곳 | 특징 |
|------|---------|------|
| **RandomForest** | UC 버클리 (2001) | 200개 결정나무의 다수결, 안정적 |
| **GradientBoosting** | 스탠퍼드 (1999) | 실수를 반복 보완, 정밀한 패턴 포착 |
| **LightGBM** | Microsoft (2017) | 빠른 속도, 대용량 데이터에 강함 |

> 앙상블이란? 3명의 전문가에게 의견을 물어 평균을 내는 방식.  
> 한 모델이 틀려도 나머지가 보완해줘서 더 안정적입니다.

### AI가 분석하는 12가지 특성

| 분류 | 특성 | 설명 |
|------|------|------|
| 밸류에이션 | PER | 이익 대비 주가 (낮을수록 저평가) |
| 밸류에이션 | PBR | 자산 대비 주가 (1 미만이면 자산보다 싸게 거래) |
| 밸류에이션 | 배당수익률 | 배당금 / 주가 × 100 (%) |
| 규모 | 시가총액 | 회사의 총 가치 (억원) |
| 모멘텀 | 모멘텀_1m | 1개월 주가 변화율 (%) |
| 모멘텀 | 모멘텀_3m | 3개월 주가 변화율 (%) |
| 모멘텀 | 모멘텀_6m | 6개월 주가 변화율 (%) |
| 리스크 | 변동성 | 주가 등락의 들쭉날쭉함 정도 |
| 리스크 | 거래량변화 | 최근 거래량 증감 (%) |
| 기술적 | RSI | 과매수(70↑)/과매도(30↓) 지표 |
| 기술적 | 볼린저위치 | 볼린저밴드 내 현재가 위치 (0~1) |
| 기술적 | 52주위치 | 52주 최고/최저가 사이 위치 (%) |

---

## 💻 실행 환경 준비

### 권장 환경: Google Colab (무료)

> 구글 코랩은 별도 설치 없이 브라우저에서 파이썬을 실행할 수 있는 무료 서비스입니다.  
> [https://colab.research.google.com](https://colab.research.google.com) 에서 구글 계정으로 시작하세요.

### 필요한 패키지 (코드 첫 줄에서 자동 설치됨)

```python
!pip install pykrx pandas numpy scikit-learn lightgbm matplotlib seaborn -q
```

| 패키지 | 역할 |
|--------|------|
| pykrx | 한국 주식 데이터 수집 |
| pandas | 표(데이터) 처리 |
| numpy | 수학 계산 |
| scikit-learn | AI 모델 (RandomForest, GBM) |
| lightgbm | AI 모델 (LightGBM) |
| matplotlib | 그래프 그리기 |
| seaborn | 예쁜 그래프 |

---

## ▶️ 실행 방법

### 방법 1: Google Colab에서 실행 (권장)

**1단계** - 구글 코랩 접속  
[https://colab.research.google.com](https://colab.research.google.com) 에서 새 노트북 만들기

**2단계** - 코드 업로드  
`quant_trading_v2_commented.py` 파일을 코랩에 붙여넣기

**3단계** - 실행  
상단 메뉴 `런타임 → 모두 실행` 또는 `Ctrl + F9`

> ⚠️ 코랩은 일정 시간 미사용 시 세션이 끊깁니다.  
> 데이터 수집 중 끊기면 캐시 덕분에 이어서 수집 가능합니다.

### 방법 2: 수집 기간 조정

```python
# 기본값: 2023~2025년 (약 3~4시간)
df_raw = collect_multi_year_data(start_year=2023, end_year=2025, top_n=500)

# 빠른 테스트: 2024~2025년 (약 1~2시간)
df_raw = collect_multi_year_data(start_year=2024, end_year=2025, top_n=500)

# 종목 수 줄이기: 300개 (약 2시간)
df_raw = collect_multi_year_data(start_year=2023, end_year=2025, top_n=300)
```

---

## 📊 결과 해석 방법

### 교차검증 결과 읽기

```
Fold 1 | 학습: 20230131~20241031 | 검증: 20241128 | ACC: 0.543 | AUC: 0.561
Fold 2 | 학습: 20230131~20241128 | 검증: 20241230 | ACC: 0.528 | AUC: 0.548
```

| 항목 | 설명 | 기준 |
|------|------|------|
| ACC (정확도) | 상승/하락을 맞춘 비율 | 0.5 = 동전던지기, 0.55↑ = 의미 있음 |
| AUC | 예측 품질 종합 점수 | 0.5 = 무의미, 0.6↑ = 어느 정도 예측력 |

> 주식 예측의 특성상 ACC 55%, AUC 0.55 이상이면 충분히 활용 가능한 수준입니다.

### 종목 선정 결과 읽기

```
종목        PER   PBR  배당수익률  모멘텀_1m   RSI   AI_점수
삼양홀딩스  16.65  0.22    2.50      5.55      42.3   0.721
경동도시가스  4.44  0.28    3.20      4.61      38.7   0.760
```

| 항목 | 해석 방법 |
|------|----------|
| AI_점수 | 0~1 사이, 높을수록 상승 가능성 높다고 AI가 판단 |
| PER 낮음 | 이익 대비 주가가 저렴 (저평가 신호) |
| PBR 낮음 | 자산 대비 주가가 저렴 (1 미만이면 특히 저평가) |
| 배당수익률 높음 | 배당을 많이 주는 안정적 종목 |
| RSI 30~50 | 과매도 구간에서 반등 가능성 |

### 결과 그래프 읽기

| 그래프 | 보는 방법 |
|--------|----------|
| 종목별 수익률 | 초록색 = 수익, 빨간색 = 손실 |
| AI 점수 vs 수익률 | 우상향 추세면 AI 예측이 유효함 |
| 월별 시장 상승 비율 | 50% 기준선 위면 그달은 상승장 |
| PBR 분포 | 상승/하락 종목의 PBR 분포 차이 확인 |

---

## ⚠️ 주의사항

### 반드시 읽어주세요

> **이 프로그램은 투자 참고용이며, 투자 결과에 대한 책임은 본인에게 있습니다.**  
> AI가 과거 패턴을 학습했다고 해서 미래를 완벽하게 예측하지는 못합니다.

### 기술적 주의사항

**1. 데이터 수집 시간**  
3개년 × 12개월 × 500종목 = 약 18,000번의 API 호출  
예상 소요 시간: **3~4시간** (캐시가 있으면 훨씬 단축)

**2. 코랩 세션 관리**  
코랩은 90분 이상 미사용 시 세션이 자동 종료됩니다.  
수집 중 끊기면 `stock_cache_v2/` 폴더의 캐시를 유지한 채 재실행하세요.

**3. 캐시 폴더**  
`stock_cache_v2/` 폴더에 수집한 데이터가 저장됩니다.  
같은 날짜를 다시 수집할 때는 캐시를 읽어서 빠르게 처리합니다.  
캐시를 초기화하려면 이 폴더를 삭제하세요.

**4. pykrx 제한**  
pykrx는 KRX(한국거래소) 웹사이트를 통해 데이터를 가져옵니다.  
너무 빠르게 많은 요청을 보내면 일시적으로 차단될 수 있습니다.  
코드에 딜레이(대기시간)가 적용되어 있어 정상적으로 실행하면 문제없습니다.

**5. 데이터 제공 범위**  
pykrx는 약 5년 이내의 데이터를 안정적으로 제공합니다.  
2020년 이전 데이터는 일부 누락될 수 있습니다.

---

## 📁 파일 구조

```
📦 quant-trading/
 ┣ 📄 quant_trading_v2_commented.py   ← 메인 코드 (주석 포함)
 ┣ 📄 README.md                        ← 이 파일
 ┗ 📁 stock_cache_v2/                  ← 캐시 폴더 (실행 후 자동 생성)
     ┣ 005930_20250131.pkl             ← 삼성전자 2025년 1월 캐시
     ┣ 005930_20250228.pkl
     ┗ ...
```

---

## 🔖 버전 히스토리

### v2.0 (현재)
- ✅ 학습 데이터 확대: 1개년 → 3개년 (2023~2025)
- ✅ 특성 확대: 5개 → 12개 (거래량, 시총, 배당수익률, RSI, 볼린저밴드 등 추가)
- ✅ 검증 방식 개선: 랜덤 분할 → 시계열 분할 (Walk-Forward)
- ✅ 앙상블 모델 적용: 단일 RF → RF + GBM + LightGBM
- ✅ 종목 선정 기준 개선: 종목코드 순 → 시가총액 상위 순

### v1.0
- 2025년 1개년 데이터 수집
- RandomForest 단일 모델
- 5가지 특성 (PER, PBR, 모멘텀 3종, 변동성)
- 랜덤 분할 검증

---

## 📞 문의

이 코드를 사용하다 문제가 생기면 GitHub Issues를 통해 문의해 주세요.

---

*마지막 업데이트: 2026년 2월*
